<script src="tinyTester.js"></script>
<script>
// Ability to load library in any order and an array of nested dependencies.

(function() {

  var libStorage = {};

  function libraryLoader(libName, dependencies, cb) {
    if (arguments.length > 1) {
      libStorage[libName] = {
        library: cb,
        dependencies: dependencies,
        cached: false
      }
    } else {
      return nestedDependencies(libName);
    };
  }

  function nestedDependencies(libName) {
    var dependencies = [];
    var libraries = libStorage[libName];

    if (typeof libraries === 'undefined') {
      throw new Error('Library or dependencies missing for ' + libName);
    }

    if (libraries.dependencies.length) {
      dependencies = libraries.dependencies.map(function(dependency) {
        return nestedDependencies(dependency);
      });
    }

    if (libraries.cached) {
      return libraries.cache;
    }

    var result = libraries.library.apply(null, dependencies);
    libraries.cached = true;
    libraries.cache = result;
    return result;
  };

  window.libraryLoader = libraryLoader;
})();



tests({
  'it should take a library name and a function that returns the library as arguments and store them': function() {
    libraryLoader('app', [], function() {
      return 'app';
    });

    eq(libraryLoader('app'), 'app');
  },

  'it should handle a library with dependencies when added in order': function() {
    libraryLoader('dependency', [], function() {
      return 'loaded dependency';
    });

    libraryLoader('app', ['dependency'], function(dependency) {
      return 'app with ' + dependency;
    });

    eq(libraryLoader('app'), 'app with loaded dependency');
  },

  'it should handle a library with 0 dependencies': function() {
    libraryLoader('name', [], function() {
      return 'Nick';
    });

    eq(libraryLoader('name'), 'Nick');
  },

























});




</script>
